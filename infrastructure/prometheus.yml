global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'ai-modernizer-monitor'
    environment: 'poc'
    cluster: 'local-dev'

# Alerting configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets: []

# Load rules once and periodically evaluate them
rule_files:
  # - "alerts.yml"
  # - "recording_rules.yml"

scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # AI Modernizer Application Metrics
  - job_name: 'ai-modernizer'
    scrape_interval: 10s
    scrape_timeout: 5s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['ai-modernizer:8000']
        labels:
          service: 'ai-modernizer'
          app: 'code-modernizer'
          component: 'main'
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - source_labels: [__scheme__]
        target_label: scheme

  # Container Registry Metrics (if exposed)
  - job_name: 'container-registry'
    static_configs:
      - targets: ['registry:5000/v2']
        labels:
          service: 'registry'
    metrics_path: '/metrics'
    scrape_interval: 30s

  # Node Exporter Metrics (if using)
  - job_name: 'node'
    static_configs:
      - targets: ['localhost:9100']
        labels:
          service: 'node-exporter'
    scrape_interval: 30s

  # Custom Endpoints
  - job_name: 'api-endpoints'
    static_configs:
      - targets: 
          - 'http://ai-modernizer:8000/health'
          - 'http://ai-modernizer:8000/api/status'
        labels:
          service: 'health-checks'
    scrape_interval: 5s
    scrape_timeout: 3s

  # Docker Container Stats
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['localhost:8080']
        labels:
          service: 'cadvisor'
    scrape_interval: 30s

remote_write:
  # Optional: Configure remote write to Azure Monitor
  # - url: "https://your-log-analytics-workspace.api.monitor.azure.com/api/metrics/v1"
  #   bearer_token: "your-bearer-token"
  #   queue_config:
  #     capacity: 10000
  #     max_shards: 200
  #     min_shards: 1
  #     max_samples_per_send: 500
  #     batch_send_wait_time: 5s
  #     min_back_off: 30ms
  #     max_back_off: 100ms
